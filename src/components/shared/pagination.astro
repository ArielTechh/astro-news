---
type BreadcrumbItem = {
  label: string;
  url: string;
  isActive?: boolean;
};

type Props = {
  currentPage: {
    title: string;
    url: string;
  };
  categories?: Array<{
    name: string;
    slug: string;
    parent?: {
      name: string;
      slug: string;
      parent?: {
        name: string;
        slug: string;
      };
    };
  }>;
  homeLabel?: string;
  homeUrl?: string;
};

const {
  currentPage,
  categories = [],
  homeLabel = "Accueil",
  homeUrl = "/",
} = Astro.props;

// Fonction pour construire la hiérarchie des catégories
function buildCategoryHierarchy(categories: any[]): BreadcrumbItem[] {
  const hierarchy: BreadcrumbItem[] = [];

  for (const category of categories) {
    // Ajouter les parents d'abord (récursivement)
    if (category.parent) {
      const parentHierarchy = buildCategoryHierarchy([category.parent]);
      hierarchy.push(...parentHierarchy);
    }

    // Ajouter la catégorie actuelle
    hierarchy.push({
      label: category.name,
      url: `/categories/${category.slug}/1`,
    });
  }

  return hierarchy;
}

// Construire le breadcrumb complet
const breadcrumbItems: BreadcrumbItem[] = [
  // Homepage
  {
    label: homeLabel,
    url: `${homeUrl}1`,
  },
  // Catégories parentes
  ...buildCategoryHierarchy(categories),
  // Page actuelle
  {
    label: currentPage.title,
    url: `${currentPage.url}/1`,
    isActive: true,
  },
];
---

<nav aria-label="Breadcrumb" class="mb-6">
  <div class="text-sm breadcrumbs">
    <ul>
      {
        breadcrumbItems.map((item, index) => (
          <li>
            {item.isActive ? (
              <span
                class="text-base-content/70 font-medium"
                aria-current="page"
              >
                {item.label}
              </span>
            ) : (
              <a
                href={item.url}
                class="link link-hover text-primary"
                {...(index === 0 ? { "aria-label": "Retour à l'accueil" } : {})}
              >
                {item.label}
              </a>
            )}
          </li>
        ))
      }
    </ul>
  </div>
</nav>

<style>
  .breadcrumb {
    margin-bottom: 1.5rem;
  }

  .breadcrumbs ul li:not(:last-child)::after {
    content: "›";
    margin-left: 0.5rem;
    margin-right: 0.5rem;
    opacity: 0.5;
  }

  .breadcrumbs ul li:last-child {
    font-weight: 500;
  }
</style>
