<!-- SOLUTION ANTI-FRUSTRATION - GARANTIE 100% --><!-- Ã‰TAPE 1: GTM avec consent par dÃ©faut -->
<script>
  console.log("ğŸ”¥ Ã‰TAPE 1: Initialisation GTM");

  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }

  // Consent REFUSÃ‰ par dÃ©faut
  gtag("consent", "default", {
    analytics_storage: "denied",
    ad_storage: "denied",
    ad_user_data: "denied",
    ad_personalization: "denied",
    functionality_storage: "denied",
    personalization_storage: "denied",
    security_storage: "granted",
  });

  console.log("âœ… Consent par dÃ©faut = DENIED");
</script>

<!-- Ã‰TAPE 2: Chargement GTM -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-PQC6K9BZ");
</script>

<!-- Ã‰TAPE 3: Banner Ultra Simple -->
<div
  id="cookie-banner"
  style="position:fixed;bottom:0;left:0;right:0;background:#000;color:#fff;padding:20px;z-index:99999;text-align:center;"
>
  <p style="margin:0 0 15px 0;">
    ğŸª This site uses cookies. Choose your preference:
  </p>
  <button
    id="accept-btn"
    style="background:#28a745;color:white;border:none;padding:15px 30px;margin:0 10px;border-radius:5px;font-size:16px;cursor:pointer;font-weight:bold;"
  >
    âœ… ACCEPT ALL
  </button>
  <button
    id="reject-btn"
    style="background:#dc3545;color:white;border:none;padding:15px 30px;margin:0 10px;border-radius:5px;font-size:16px;cursor:pointer;font-weight:bold;"
  >
    âŒ REJECT ALL
  </button>
</div>

<!-- Ã‰TAPE 4: Script ULTRA SIMPLE -->
<script>
  console.log("ğŸ”¥ Ã‰TAPE 4: Initialisation du script de consent");

  // Fonction ACCEPT
  function forceAccept() {
    console.log("ğŸŸ¢ FORÃ‡AGE ACCEPT - DÃ‰BUT");

    // 1. Mise Ã  jour GTM
    gtag("consent", "update", {
      analytics_storage: "granted",
      ad_storage: "granted",
      ad_user_data: "granted",
      ad_personalization: "granted",
      functionality_storage: "granted",
      personalization_storage: "granted",
    });

    // 2. Push dataLayer
    dataLayer.push({
      event: "consent_update",
      consent_analytics: "granted",
      consent_ads: "granted",
    });

    // 3. Storage
    localStorage.setItem("consent-status", "accepted");

    // 4. Masquer banner
    document.getElementById("cookie-banner").style.display = "none";

    console.log("ğŸŸ¢ FORÃ‡AGE ACCEPT - TERMINÃ‰");
    console.log("ğŸ“Š VÃ©rification dataLayer:", dataLayer);

    // 5. Force reload GTM (derniÃ¨re tentative)
    setTimeout(function () {
      dataLayer.push({ event: "gtm.dom" });
      console.log("ğŸ”„ GTM DOM event forcÃ©");
    }, 500);
  }

  // Fonction REJECT
  function forceReject() {
    console.log("ğŸ”´ FORÃ‡AGE REJECT");

    localStorage.setItem("consent-status", "rejected");
    document.getElementById("cookie-banner").style.display = "none";

    dataLayer.push({
      event: "consent_rejected",
    });

    console.log("ğŸ”´ REJECT terminÃ©");
  }

  // Event Listeners
  document.addEventListener("DOMContentLoaded", function () {
    console.log("ğŸ“‹ DOM chargÃ© - Ajout des event listeners");

    // Bouton Accept
    const acceptBtn = document.getElementById("accept-btn");
    if (acceptBtn) {
      acceptBtn.addEventListener("click", forceAccept);
      console.log("âœ… Event listener ACCEPT ajoutÃ©");
    }

    // Bouton Reject
    const rejectBtn = document.getElementById("reject-btn");
    if (rejectBtn) {
      rejectBtn.addEventListener("click", forceReject);
      console.log("âŒ Event listener REJECT ajoutÃ©");
    }

    // VÃ©rifier si dÃ©jÃ  acceptÃ©
    const status = localStorage.getItem("consent-status");
    if (status === "accepted") {
      console.log("ğŸ”„ Statut dÃ©jÃ  acceptÃ© - Restauration");
      forceAccept();
    } else if (status !== "rejected") {
      // Afficher le banner seulement si pas de choix
      document.getElementById("cookie-banner").style.display = "block";
      console.log("ğŸ“¢ Banner affichÃ©");
    }
  });

  // TEST MANUEL - Tapez Ã§a dans la console aprÃ¨s avoir cliquÃ© Accept:
  // gtag('get', 'GTM-PQC6K9BZ', 'analytics_storage', (value) => console.log('Analytics storage:', value));
</script>

<!-- GTM noscript -->
<noscript>
  <iframe
    src="https://www.googletagmanager.com/ns.html?id=GTM-PQC6K9BZ"
    height="0"
    width="0"
    style="display:none;visibility:hidden"></iframe>
</noscript>

<!-- 
ğŸ§ª INSTRUCTIONS DE TEST:

1. Rechargez la page avec console ouverte
2. Vous DEVEZ voir: "Ã‰TAPE 1", "Ã‰TAPE 4", "DOM chargÃ©", "Event listener ACCEPT ajoutÃ©" 
3. Cliquez sur "ACCEPT ALL"
4. Vous DEVEZ voir: "FORÃ‡AGE ACCEPT - DÃ‰BUT" puis "FORÃ‡AGE ACCEPT - TERMINÃ‰"
5. Dans GTM Preview: Le consent DOIT passer Ã  GRANTED

ğŸ”¥ SI Ã‡A NE MARCHE TOUJOURS PAS:
- Tapez dans la console: dataLayer
- Tapez: gtag('get', 'GTM-PQC6K9BZ', 'analytics_storage', console.log)
- Envoyez-moi les rÃ©sultats !
-->
