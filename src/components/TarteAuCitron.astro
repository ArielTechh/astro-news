<!-- Google Consent Mode v2 - SIMPLE ET EFFICACE -->
<script>
  // Consentement par d√©faut (AVANT GTM)
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }

  gtag("consent", "default", {
    analytics_storage: "denied",
    ad_storage: "denied",
    ad_user_data: "denied",
    ad_personalization: "denied",
    functionality_storage: "denied",
    personalization_storage: "denied",
    security_storage: "granted",
  });
</script>

<!-- GTM -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-PQC6K9BZ");
</script>

<!-- Cookie Consent Banner -->
<div
  id="consent-banner"
  style="position:fixed;bottom:0;left:0;right:0;background:#1a1a1a;color:white;padding:20px;z-index:9999;display:none;"
>
  <div
    style="max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:20px;flex-wrap:wrap;"
  >
    <div style="flex:1;min-width:300px;">
      <p style="margin:0;font-size:14px;">
        üç™ We use cookies to improve your experience and deliver personalized
        content.
        <a href="/privacy-policy" style="color:#4CAF50;">Privacy Policy</a>
      </p>
    </div>
    <div style="display:flex;gap:10px;">
      <button
        id="accept-all-btn"
        style="background:#4CAF50;color:white;border:none;padding:12px 24px;border-radius:5px;cursor:pointer;"
      >
        ‚úì Accept All
      </button>
      <button
        id="reject-all-btn"
        style="background:#f44336;color:white;border:none;padding:12px 24px;border-radius:5px;cursor:pointer;"
      >
        ‚úó Reject All
      </button>
      <button
        id="customize-btn"
        style="background:#2196F3;color:white;border:none;padding:12px 24px;border-radius:5px;cursor:pointer;"
      >
        ‚öôÔ∏è Customize
      </button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div
  id="consent-settings"
  style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:10000;display:none;align-items:center;justify-content:center;"
>
  <div
    style="background:white;padding:30px;border-radius:10px;max-width:500px;width:90%;"
  >
    <h3 style="margin-top:0;">Cookie Settings</h3>

    <div style="margin:20px 0;">
      <label
        style="display:flex;align-items:center;margin:15px 0;cursor:pointer;"
      >
        <input type="checkbox" id="analytics" style="margin-right:10px;" />
        <div>
          <strong>Analytics Cookies</strong><br />
          <small style="color:#666;"
            >Help us understand how visitors interact with our website</small
          >
        </div>
      </label>

      <label
        style="display:flex;align-items:center;margin:15px 0;cursor:pointer;"
      >
        <input type="checkbox" id="advertising" style="margin-right:10px;" />
        <div>
          <strong>Advertising Cookies</strong><br />
          <small style="color:#666;"
            >Used to deliver personalized advertisements</small
          >
        </div>
      </label>

      <label
        style="display:flex;align-items:center;margin:15px 0;cursor:pointer;"
      >
        <input type="checkbox" id="functional" style="margin-right:10px;" />
        <div>
          <strong>Functional Cookies</strong><br />
          <small style="color:#666;"
            >Enable enhanced functionality and personalization</small
          >
        </div>
      </label>

      <div
        style="background:#f5f5f5;padding:10px;border-radius:5px;margin:15px 0;"
      >
        <label style="display:flex;align-items:center;cursor:not-allowed;">
          <input type="checkbox" checked disabled style="margin-right:10px;" />
          <div>
            <strong>Essential Cookies</strong><br />
            <small style="color:#666;"
              >Required for basic website functionality (always active)</small
            >
          </div>
        </label>
      </div>
    </div>

    <div
      style="display:flex;gap:10px;justify-content:flex-end;margin-top:30px;"
    >
      <button
        id="cancel-settings-btn"
        style="background:#666;color:white;border:none;padding:12px 20px;border-radius:5px;cursor:pointer;"
      >
        Cancel
      </button>
      <button
        id="save-settings-btn"
        style="background:#4CAF50;color:white;border:none;padding:12px 20px;border-radius:5px;cursor:pointer;"
      >
        Save Preferences
      </button>
    </div>
  </div>
</div>

<script>
  // Initialize consent system immediately
  (function () {
    "use strict";

    console.log("üç™ Initializing Cookie Consent System");

    // Consent Management Functions
    function showBanner() {
      if (!localStorage.getItem("consent-choice")) {
        const banner = document.getElementById("consent-banner");
        if (banner) {
          banner.style.display = "block";
        }
      }
    }

    function acceptConsent() {
      console.log("‚úÖ Accept All clicked");

      // Grant all consent types
      if (typeof gtag !== "undefined") {
        gtag("consent", "update", {
          analytics_storage: "granted",
          ad_storage: "granted",
          ad_user_data: "granted",
          ad_personalization: "granted",
          functionality_storage: "granted",
          personalization_storage: "granted",
        });
      }

      localStorage.setItem("consent-choice", "accepted");
      document.getElementById("consent-banner").style.display = "none";

      // Trigger GTM events
      if (typeof dataLayer !== "undefined") {
        dataLayer.push({
          event: "consent_granted",
          consent_method: "accept_all",
        });
      }

      console.log("‚úÖ All cookies accepted and GTM updated");
    }

    function denyConsent() {
      console.log("‚ùå Reject All clicked");

      // Keep consent denied (already set as default)
      localStorage.setItem("consent-choice", "denied");
      document.getElementById("consent-banner").style.display = "none";

      if (typeof dataLayer !== "undefined") {
        dataLayer.push({
          event: "consent_denied",
          consent_method: "reject_all",
        });
      }

      console.log("‚ùå All cookies rejected");
    }

    function showSettings() {
      console.log("‚öôÔ∏è Show settings clicked");
      document.getElementById("consent-settings").style.display = "flex";
    }

    function closeSettings() {
      document.getElementById("consent-settings").style.display = "none";
    }

    function saveSettings() {
      const analytics = document.getElementById("analytics").checked;
      const advertising = document.getElementById("advertising").checked;
      const functional = document.getElementById("functional").checked;

      console.log("‚öôÔ∏è Saving custom settings:", {
        analytics,
        advertising,
        functional,
      });

      // Update consent based on user choices
      if (typeof gtag !== "undefined") {
        gtag("consent", "update", {
          analytics_storage: analytics ? "granted" : "denied",
          ad_storage: advertising ? "granted" : "denied",
          ad_user_data: advertising ? "granted" : "denied",
          ad_personalization: advertising ? "granted" : "denied",
          functionality_storage: functional ? "granted" : "denied",
          personalization_storage: functional ? "granted" : "denied",
        });
      }

      // Save user preferences
      localStorage.setItem("consent-choice", "custom");
      localStorage.setItem(
        "consent-settings",
        JSON.stringify({
          analytics,
          advertising,
          functional,
        }),
      );

      closeSettings();
      document.getElementById("consent-banner").style.display = "none";

      if (typeof dataLayer !== "undefined") {
        dataLayer.push({
          event: "consent_updated",
          consent_method: "custom",
          analytics_consent: analytics,
          advertising_consent: advertising,
          functional_consent: functional,
        });
      }

      console.log("‚öôÔ∏è Custom cookie preferences saved");
    }

    // Restore previous consent choices on page load
    function restoreConsent() {
      const choice = localStorage.getItem("consent-choice");

      if (choice === "accepted") {
        // User previously accepted all
        if (typeof gtag !== "undefined") {
          gtag("consent", "update", {
            analytics_storage: "granted",
            ad_storage: "granted",
            ad_user_data: "granted",
            ad_personalization: "granted",
            functionality_storage: "granted",
            personalization_storage: "granted",
          });
        }
        console.log("üîÑ Restored: All cookies accepted");
      } else if (choice === "custom") {
        // User had custom settings
        const settings = JSON.parse(
          localStorage.getItem("consent-settings") || "{}",
        );
        if (typeof gtag !== "undefined") {
          gtag("consent", "update", {
            analytics_storage: settings.analytics ? "granted" : "denied",
            ad_storage: settings.advertising ? "granted" : "denied",
            ad_user_data: settings.advertising ? "granted" : "denied",
            ad_personalization: settings.advertising ? "granted" : "denied",
            functionality_storage: settings.functional ? "granted" : "denied",
            personalization_storage: settings.functional ? "granted" : "denied",
          });
        }
        console.log("üîÑ Restored custom settings:", settings);
      }
      // If 'denied' or no choice, keep default denied state
    }

    // Show cookie preferences button (for footer links)
    function showCookiePreferences() {
      document.getElementById("consent-banner").style.display = "block";
    }

    // Event listeners setup
    function setupEventListeners() {
      // Accept All button
      const acceptBtn = document.getElementById("accept-all-btn");
      if (acceptBtn) {
        acceptBtn.addEventListener("click", acceptConsent);
      }

      // Reject All button
      const rejectBtn = document.getElementById("reject-all-btn");
      if (rejectBtn) {
        rejectBtn.addEventListener("click", denyConsent);
      }

      // Customize button
      const customizeBtn = document.getElementById("customize-btn");
      if (customizeBtn) {
        customizeBtn.addEventListener("click", showSettings);
      }

      // Cancel settings button
      const cancelBtn = document.getElementById("cancel-settings-btn");
      if (cancelBtn) {
        cancelBtn.addEventListener("click", closeSettings);
      }

      // Save settings button
      const saveBtn = document.getElementById("save-settings-btn");
      if (saveBtn) {
        saveBtn.addEventListener("click", saveSettings);
      }
    }

    // Initialize everything when DOM is ready
    function init() {
      setupEventListeners();
      restoreConsent();
      showBanner();
      console.log("üç™ Cookie consent system fully initialized");
    }

    // Make showCookiePreferences available globally for footer links
    window.showCookiePreferences = showCookiePreferences;

    // Initialize when DOM is ready
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init);
    } else {
      init();
    }
  })();

  // Optional: Add this link to your footer
  // <a href="#" onclick="showCookiePreferences(); return false;">Cookie Settings</a>
</script>

<noscript>
  <iframe
    src="https://www.googletagmanager.com/ns.html?id=GTM-PQC6K9BZ"
    height="0"
    width="0"
    style="display:none;visibility:hidden"></iframe>
</noscript>
