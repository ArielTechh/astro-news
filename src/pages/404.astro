---
import { getEntry } from "astro:content";
import BaseLayout from "../layouts/base.astro";

const entry = await getEntry("views", "error404");

if (!entry) {
  throw new Error("404 page not found");
}

const [HERO] = entry.data.blocks;
---

<BaseLayout entry={entry}>
  <div class="container flex flex-col items-center justify-center py-20">
    <h1 class="text-4xl">{HERO.title}</h1>
    <p class="mt-2">{HERO.description}</p>
    <a href={HERO.link_url} class="btn mt-6" aria-label="Return to Homepage"
      >{HERO.link_text}</a
    >
  </div>
</BaseLayout>

<script>
  // Redirection intelligente pour les pages de pagination inexistantes
  const currentPath = window.location.pathname;
  const paginationMatch = currentPath.match(/^\/categories\/([^\/]+)\/(\d+)$/);

  if (paginationMatch) {
    const [, categorySlug, pageNum] = paginationMatch;
    const pageNumber = parseInt(pageNum);

    // Rediriger vers la page 1 de la catégorie pour les pages inexistantes
    if (pageNumber > 1) {
      // Utiliser replace() pour que l'utilisateur ne puisse pas revenir à la 404
      window.location.replace(`/categories/${categorySlug}`);
    }
  }
</script>
